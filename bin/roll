#!/usr/bin/env python3
'''
Simple dice roller.

Use like `roll d20`, `roll 3d40 * 4 + 10`, etc.
'''

from argparse import ArgumentParser
import math
import random
import re

def dice(N: int) -> int:
    return random.randint(1, N)

def multidice(M: int, N: int):
    return sum(dice(N) for _ in range(M))

NAMESPACE = {'dice': dice, 'multidice': multidice}
NAMESPACE.update(math.__dict__)
def roll(expression: str):
    expression = re.sub(r'(\d)+d(\d+)', r'multidice(\1, \2)', expression)
    expression = re.sub(r'd(\d+)', r'dice(\1)', expression)
    # print(expression)
    return eval(expression, {}, NAMESPACE)

if __name__ == '__main__':
    parser = ArgumentParser()
    parser.add_argument('expression', nargs='*', help='Dice expression, eg 3d40 * 1d2.')
    print(roll(' '.join(parser.parse_args().expression)))